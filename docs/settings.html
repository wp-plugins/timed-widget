<!DOCTYPE html>  <html> <head>   <title>settings.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               settings.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Timed Widget</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Author:</h2>

<p>Daniel Yule </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Version:</h2>

<p>0.2</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Overview:</h2>

<p>This file is responsible for providing the interface logic for the
Timed Widget Settings Page. In essence, it ties together the various elements
on the page with jQuery and handles AJAX communication with the server.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Dependencies:</h2>

<ul>
<li>jQuery</li>
<li>jQueryUI</li>
<li>Date.js</li>
<li>jquery-weekcalendar</li>
<li>jquery-datepicker</li>
<li>jQuery {buttons, dialog, accordion, tabs}</li>
<li>custom-colorpicker</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>Details:</h2>

<p>The html code that this javascript interacts with is found in tw-settings.php, 
 within the function tw_settings_display().  There are three major objects in
use throughout this code.  The first is code blocks.</p>

<p><strong>Codeblocks</strong> are simply an arbitrary string that will be displayed on the page at 
a scheduled time.  They can be html elements, javascript or some combination of 
the two.  Each codeblock has a name, a color and the associated string. The name
and color are for readabilty for the user, so it is easy to tell which timeslot
is associated with which codeblock.  Internally, they are tracked using an id, but
this is never shown to the user.  Codeblocks are stored in a global array, which is
indexed by the codeblock's id.</p>

<p><strong>Timeslots</strong> are designed to be a recurring sheduled event.  Timeslots start on a
particular day, end on either the same day or a later day, and occur only on selected
days of the week, between specific hours.  A timeslot is a recurring event, wherein a
codeblock is displayed for as long as that timeslot is active.  A timeslot has a
start date, an end date, a start time, an end time and an associated codeblock.  A
timeslot also has seven flags, one for each day of the week that specifies whether or
not the timeslot is active on that day of the week.  The codeblock is displayed from
the start time to the end time, every day, starting on the starting date and ending on 
the ending date, so long as the day of the week has been selected.    </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h1>Global Declarations</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">codeblocks</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">current_block_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">current_schedule_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">htmlDecode</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
	<span class="nx">e</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">input</span><span class="p">;</span>
	<span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">HexToRGB</span><span class="p">(</span><span class="nx">hex</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">hex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(((</span><span class="nx">hex</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="nx">hex</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
	<span class="k">return</span> <span class="p">{</span>
		<span class="nx">r</span> <span class="o">:</span> <span class="nx">hex</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span>
		<span class="nx">g</span> <span class="o">:</span> <span class="p">(</span><span class="nx">hex</span> <span class="o">&amp;</span> <span class="mh">0x00FF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span>
		<span class="nx">b</span> <span class="o">:</span> <span class="p">(</span><span class="nx">hex</span> <span class="o">&amp;</span> <span class="mh">0x0000FF</span><span class="p">)</span>
	<span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">HexToHSB</span><span class="p">(</span><span class="nx">hex</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">RGBToHSB</span><span class="p">(</span><span class="nx">HexToRGB</span><span class="p">(</span><span class="nx">hex</span><span class="p">));</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">RGBToHSB</span><span class="p">(</span><span class="nx">rgb</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">hsb</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">h</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
		<span class="nx">s</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
		<span class="nx">b</span> <span class="o">:</span> <span class="mi">0</span>
	<span class="p">};</span>
	<span class="kd">var</span> <span class="nx">min</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">g</span><span class="p">,</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">b</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">g</span><span class="p">,</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">b</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">delta</span> <span class="o">=</span> <span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">;</span>
	<span class="nx">hsb</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">max</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">max</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

	<span class="p">}</span>
	<span class="nx">hsb</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">max</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">*</span> <span class="nx">delta</span> <span class="o">/</span> <span class="nx">max</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">hsb</span><span class="p">.</span><span class="nx">s</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">r</span> <span class="o">==</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">hsb</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">g</span> <span class="o">-</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">delta</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">g</span> <span class="o">==</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">hsb</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="o">/</span> <span class="nx">delta</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">hsb</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">r</span> <span class="o">-</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">g</span><span class="p">)</span> <span class="o">/</span> <span class="nx">delta</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">hsb</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nx">hsb</span><span class="p">.</span><span class="nx">h</span> <span class="o">*=</span> <span class="mi">60</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">hsb</span><span class="p">.</span><span class="nx">h</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">hsb</span><span class="p">.</span><span class="nx">h</span> <span class="o">+=</span> <span class="mi">360</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nx">hsb</span><span class="p">.</span><span class="nx">s</span> <span class="o">*=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">255</span><span class="p">;</span>
	<span class="nx">hsb</span><span class="p">.</span><span class="nx">b</span> <span class="o">*=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">255</span><span class="p">;</span>
	<span class="k">return</span> <span class="nx">hsb</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">checkVisibility</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">current_block_id</span> <span class="o">&amp;&amp;</span> <span class="nx">codeblocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_select&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;tb-hidden&quot;</span><span class="p">);</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_info&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;tb-hidden&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_select&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;tb-hidden&quot;</span><span class="p">);</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_info&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;tb-hidden&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">updateCodeblockForm</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">codeblocks</span><span class="p">[</span><span class="nx">current_block_id</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">$panel</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_panel&#39;</span><span class="p">).</span><span class="nx">detach</span><span class="p">();</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_tab_&#39;</span> <span class="o">+</span> <span class="nx">current_block_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$panel</span><span class="p">);</span>
		<span class="nx">current_block</span> <span class="o">=</span> <span class="nx">codeblocks</span><span class="p">[</span><span class="nx">current_block_id</span><span class="p">];</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">current_block</span><span class="p">.</span><span class="nx">block_name</span><span class="p">);</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_code&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">current_block</span><span class="p">.</span><span class="nx">block_code</span><span class="p">);</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">current_block</span><span class="p">.</span><span class="nx">block_color</span><span class="p">);</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#colorpicker&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span>
				<span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">current_block</span><span class="p">.</span><span class="nx">block_color</span><span class="p">);</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#colorpicker&#39;</span><span class="p">).</span><span class="nx">ColorPickerSetColor</span><span class="p">(</span>
				<span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">current_block</span><span class="p">.</span><span class="nx">block_color</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">saveCodeblockForm</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
		<span class="nx">action</span> <span class="o">:</span> <span class="s1">&#39;tw-ajax-codeblock-save&#39;</span><span class="p">,</span>
		<span class="nx">block_id</span> <span class="o">:</span> <span class="nx">current_block_id</span><span class="p">,</span>
		<span class="nx">block_name</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
		<span class="nx">block_code</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_code&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
		<span class="nx">block_color</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
	<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">saved</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>jQuery('#codeblock<em>select option[value="' + response.block</em>id +
'"]').html(response.block_name);</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">jQuery</span><span class="p">(</span>
					<span class="s1">&#39;#codeblock_tabs&gt;ul&gt;li&gt;a[href=#codeblock_tab_&#39;</span>
							<span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
					<span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_name</span><span class="p">);</span>
			<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">].</span><span class="nx">block_name</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_name</span><span class="p">;</span>
			<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">].</span><span class="nx">block_code</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_code</span><span class="p">;</span>
			<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">].</span><span class="nx">block_color</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_color</span><span class="p">;</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">removeCodeblock</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
		<span class="nx">action</span> <span class="o">:</span> <span class="s1">&#39;tw-ajax-codeblock-remove&#39;</span><span class="p">,</span>
		<span class="nx">block_id</span> <span class="o">:</span> <span class="nx">current_block_id</span>
	<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">removed</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">delete</span> <span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>$panel = jQuery('#codeblock<em>panel').detach();
codeblocks.splice(current</em>block<em>id, 1);
populateWithCodeblocks(jQuery('#codeblock</em>select'));</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_tabs&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span>
					<span class="s2">&quot;#codeblock_tab_&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">prev_id</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_tabs&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">,</span>
					<span class="s2">&quot;#codeblock_tab_&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">);</span>

			<span class="nx">current_block_id</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">prev_id</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>jQuery("#codeblock<em>select")[0].selectedIndex = current</em>block<em>id;
checkVisibility();
if(current</em>block_id &amp;&amp; codeblocks.length > 0)
updateCodeblockForm();</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">removeSchedule</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
		<span class="nx">action</span> <span class="o">:</span> <span class="s1">&#39;tw-ajax-schedule-remove&#39;</span><span class="p">,</span>
		<span class="nx">schedule_id</span> <span class="o">:</span> <span class="nx">current_schedule_id</span>
	<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">removed</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">replaced</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_tabs&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span>
						<span class="s2">&quot;#schedule_tab_&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">prev_id</span><span class="p">);</span>
				<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_tabs&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">,</span>
						<span class="s2">&quot;#schedule_tab_&quot;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">schedule_id</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">(</span>
						<span class="s1">&#39;#schedule_tabs&gt;ul&gt;li&gt;a[href=#schedule_tab_&#39;</span>
								<span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">schedule_id</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span>
						<span class="s2">&quot;Default Schedule&quot;</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="nx">current_schedule_id</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">prev_id</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>jQuery("#codeblock<em>select")[0].selectedIndex = current</em>block<em>id;
checkVisibility();
if(current</em>block_id &amp;&amp; codeblocks.length > 0)
updateCodeblockForm();</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">populateWithCodeblocks</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">element</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">codeblocks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">element</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;&lt;option&gt;&#39;</span><span class="p">,</span> <span class="p">{</span>
				<span class="nx">value</span> <span class="o">:</span> <span class="nx">key</span>
			<span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">block_name</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">generateTimeSuggestions</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span> <span class="p">{</span>

	<span class="kd">var</span> <span class="nx">cTime</span> <span class="o">=</span> <span class="nx">tryToParse</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">cTime</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">tTime</span> <span class="o">=</span> <span class="nx">cTime</span><span class="p">.</span><span class="nx">addMinutes</span><span class="p">(</span><span class="o">-</span><span class="mi">720</span><span class="p">);</span>
		<span class="nx">times</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">minuteOffset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">720</span><span class="p">;</span> <span class="nx">minuteOffset</span> <span class="o">&lt;=</span> <span class="mi">720</span><span class="p">;</span> <span class="nx">minuteOffset</span> <span class="o">+=</span> <span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">times</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tTime</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;h:mm tt&quot;</span><span class="p">));</span>
			<span class="nx">tTime</span><span class="p">.</span><span class="nx">addMinutes</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">times</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">tryToParse</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">txt</span> <span class="o">=</span> <span class="nx">txt</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
	<span class="nx">formatArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;HH&quot;</span><span class="p">,</span> <span class="s2">&quot;HHm&quot;</span><span class="p">,</span> <span class="s2">&quot;HHmm&quot;</span><span class="p">,</span> <span class="s2">&quot;H:&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:&quot;</span><span class="p">,</span> <span class="s2">&quot;H:m&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:m&quot;</span><span class="p">,</span>
			<span class="s2">&quot;H:mm&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:mm&quot;</span><span class="p">,</span> <span class="s2">&quot;H:mt&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:mt&quot;</span><span class="p">,</span> <span class="s2">&quot;H:mmt&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:mmt&quot;</span><span class="p">,</span> <span class="s2">&quot;H:mtt&quot;</span><span class="p">,</span>
			<span class="s2">&quot;HH:mtt&quot;</span><span class="p">,</span> <span class="s2">&quot;H:mmtt&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:mmtt&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="nx">formatIdx</span> <span class="k">in</span> <span class="nx">formatArray</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">cTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parseExact</span><span class="p">(</span><span class="nx">txt</span><span class="p">,</span> <span class="nx">formatArray</span><span class="p">[</span><span class="nx">formatIdx</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">cTime</span><span class="p">)</span>
			<span class="k">return</span> <span class="nx">cTime</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">addNewTimeslot</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">populateWithCodeblocks</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_codeblock&#39;</span><span class="p">));</span>

	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;dialogclose&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">closeEvent</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_start_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hh:mm tt&quot;</span><span class="p">));</span>
	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_end_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hh:mm tt&quot;</span><span class="p">));</span>

	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_start_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;dd/MM/yyyy&quot;</span><span class="p">));</span>
	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_end_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;dd/MM/yyyy&quot;</span><span class="p">));</span>

	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;.timeslot_day&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">getDay</span><span class="p">())</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_monday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_tuesday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_wednesday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_thursday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_friday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_saturday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_sunday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">dialog</span><span class="p">(</span>
					<span class="s1">&#39;option&#39;</span><span class="p">,</span>
					<span class="s1">&#39;buttons&#39;</span><span class="p">,</span>
					<span class="p">{</span>
						<span class="s2">&quot;Save&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

							<span class="kd">var</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">tryToParse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_start_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="kd">var</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">tryToParse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_end_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="kd">var</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_start_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_end_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
								<span class="nx">action</span> <span class="o">:</span> <span class="s2">&quot;tw-ajax-timeslot-add-update&quot;</span><span class="p">,</span>
								<span class="nx">codeblock_id</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_codeblock&#39;</span><span class="p">)</span>
										<span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
								<span class="nx">schedule_id</span> <span class="o">:</span> <span class="nx">current_schedule_id</span><span class="p">,</span>
								<span class="nx">start_time</span> <span class="o">:</span> <span class="nx">startTime</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;HHmm&quot;</span><span class="p">),</span>
								<span class="nx">end_time</span> <span class="o">:</span> <span class="nx">endTime</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;HHmm&quot;</span><span class="p">),</span>
								<span class="nx">start_date</span> <span class="o">:</span> <span class="nx">startDate</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">),</span>
								<span class="nx">end_date</span> <span class="o">:</span> <span class="nx">endDate</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">),</span>
								<span class="nx">on_monday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_monday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_tuesday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_tuesday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_wednesday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_wednesday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_thursday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_thursday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_friday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_friday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_saturday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_saturday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_sunday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_sunday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">)</span>
							<span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
								<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
							<span class="p">});</span>
						<span class="p">},</span>
						<span class="s2">&quot;Delete&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
							<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
						<span class="p">},</span>
						<span class="s2">&quot;Cancel&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
							<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
						<span class="p">}</span>
					<span class="p">});</span>
	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getCalendarData</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">interval_begin</span> <span class="o">=</span> <span class="nx">start</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">interval_end</span> <span class="o">=</span> <span class="nx">end</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">);</span>

	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
		<span class="s2">&quot;interval_begin&quot;</span> <span class="o">:</span> <span class="nx">interval_begin</span><span class="p">,</span>
		<span class="s2">&quot;interval_end&quot;</span> <span class="o">:</span> <span class="nx">interval_end</span><span class="p">,</span>
		<span class="s2">&quot;schedule_id&quot;</span> <span class="o">:</span> <span class="nx">current_schedule_id</span><span class="p">,</span>
		<span class="s2">&quot;action&quot;</span> <span class="o">:</span> <span class="s2">&quot;tw-ajax-list-events&quot;</span>
	<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">calEvents</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">();</span>
		<span class="kd">var</span> <span class="nx">calEvent</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">event</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="nx">eventIdx</span> <span class="k">in</span> <span class="nx">response</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">event</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">eventIdx</span><span class="p">];</span>
				<span class="nx">calEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span>
				<span class="nx">calEvent</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
				<span class="nx">calEvent</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
				<span class="nx">calEvent</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parseExact</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">date</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">starttime</span><span class="p">,</span>
						<span class="s2">&quot;yyyyMMddHHmm&quot;</span><span class="p">);</span>
				<span class="nx">calEvent</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parseExact</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">date</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">endtime</span><span class="p">,</span>
						<span class="s2">&quot;yyyyMMddHHmm&quot;</span><span class="p">);</span>
				<span class="nx">calEvent</span><span class="p">.</span><span class="nx">timeslot_id</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">timeslot_id</span><span class="p">;</span>
				<span class="nx">calEvent</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">color</span><span class="p">;</span>
				<span class="nx">calEvents</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="nx">callback</span><span class="p">(</span><span class="nx">calEvents</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">updateTimeslot</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
		<span class="nx">action</span> <span class="o">:</span> <span class="s2">&quot;tw-ajax-get-timeslot&quot;</span><span class="p">,</span>
		<span class="nx">timeslot_id</span> <span class="o">:</span> <span class="nx">calEvent</span><span class="p">.</span><span class="nx">timeslot_id</span>
	<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">start</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">end</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">populateWithCodeblocks</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_codeblock&#39;</span><span class="p">));</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_codeblock&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">codeblock_id</span><span class="p">);</span>

			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_start_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span>
					<span class="nb">Date</span><span class="p">.</span><span class="nx">parseExact</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">start_time</span><span class="p">,</span> <span class="s2">&quot;HHmm&quot;</span><span class="p">)</span>
							<span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hh:mm tt&quot;</span><span class="p">));</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_end_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span>
					<span class="nb">Date</span><span class="p">.</span><span class="nx">parseExact</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">end_time</span><span class="p">,</span> <span class="s2">&quot;HHmm&quot;</span><span class="p">)</span>
							<span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hh:mm tt&quot;</span><span class="p">));</span>

			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_start_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span>
					<span class="nb">Date</span><span class="p">.</span><span class="nx">parseExact</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">start_date</span><span class="p">,</span> <span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">)</span>
							<span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;dd/MM/yyyy&quot;</span><span class="p">));</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_end_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span>
					<span class="nb">Date</span><span class="p">.</span><span class="nx">parseExact</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">end_date</span><span class="p">,</span> <span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">)</span>
							<span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;dd/MM/yyyy&quot;</span><span class="p">));</span>

			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_monday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span>
					<span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">onMonday</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_tuesday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span>
					<span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">onTuesday</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_wednesday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span>
					<span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">onWednesday</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_thursday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span>
					<span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">onThursday</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_friday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span>
					<span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">onFriday</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_saturday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span>
					<span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">onSaturday</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_on_sunday&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span>
					<span class="nx">response</span><span class="p">.</span><span class="nx">timeslot</span><span class="p">.</span><span class="nx">onSunday</span><span class="p">);</span>

			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;dialogclose&#39;</span><span class="p">,</span>
					<span class="kd">function</span><span class="p">(</span><span class="nx">closeEvent</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>
					<span class="p">});</span>

			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span>
					<span class="s1">&#39;option&#39;</span><span class="p">,</span>
					<span class="s1">&#39;buttons&#39;</span><span class="p">,</span>
					<span class="p">{</span>
						<span class="s2">&quot;Save&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

							<span class="kd">var</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">tryToParse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_start_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="kd">var</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">tryToParse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_end_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="kd">var</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_start_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">(</span>
									<span class="s1">&#39;#timeslot_end_date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
								<span class="nx">action</span> <span class="o">:</span> <span class="s2">&quot;tw-ajax-timeslot-add-update&quot;</span><span class="p">,</span>
								<span class="nx">timeslot_id</span> <span class="o">:</span> <span class="nx">calEvent</span><span class="p">.</span><span class="nx">timeslot_id</span><span class="p">,</span>
								<span class="nx">schedule_id</span> <span class="o">:</span> <span class="nx">current_schedule_id</span><span class="p">,</span>
								<span class="nx">codeblock_id</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_codeblock&#39;</span><span class="p">)</span>
										<span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
								<span class="nx">start_time</span> <span class="o">:</span> <span class="nx">startTime</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;HHmm&quot;</span><span class="p">),</span>
								<span class="nx">end_time</span> <span class="o">:</span> <span class="nx">endTime</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;HHmm&quot;</span><span class="p">),</span>
								<span class="nx">start_date</span> <span class="o">:</span> <span class="nx">startDate</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">),</span>
								<span class="nx">end_date</span> <span class="o">:</span> <span class="nx">endDate</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">),</span>
								<span class="nx">on_monday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_monday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_tuesday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_tuesday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_wednesday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_wednesday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_thursday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_thursday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_friday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_friday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_saturday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_saturday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">),</span>
								<span class="nx">on_sunday</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
										<span class="s1">&#39;#timeslot_on_sunday:checked&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span>
										<span class="s1">&#39;checked&#39;</span><span class="p">)</span>
							<span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
								<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
							<span class="p">});</span>
						<span class="p">},</span>
						<span class="s2">&quot;Delete&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
							<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>
								<span class="nx">action</span> <span class="o">:</span> <span class="s2">&quot;tw-ajax-timeslot-remove&quot;</span><span class="p">,</span>
								<span class="nx">timeslot_id</span> <span class="o">:</span> <span class="nx">calEvent</span><span class="p">.</span><span class="nx">timeslot_id</span>
							<span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
								<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
							<span class="p">});</span>
						<span class="p">},</span>
						<span class="s2">&quot;Cancel&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
							<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
						<span class="p">}</span>
					<span class="p">});</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
		<span class="p">}</span>

	<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">readEmbeddedJSON</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">codeblocks_obj</span><span class="p">;</span>

	<span class="nx">current_block_id</span> <span class="o">=</span> <span class="nx">tw_ajax</span><span class="p">.</span><span class="nx">current_block</span><span class="p">;</span>

	<span class="nx">codeblocks_obj</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">htmlDecode</span><span class="p">(</span><span class="nx">tw_ajax</span><span class="p">.</span><span class="nx">codeblocks</span><span class="p">));</span>
	<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">codeblocks_obj</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
	<span class="p">});</span>

	<span class="nx">current_schedule_id</span> <span class="o">=</span> <span class="nx">tw_ajax</span><span class="p">.</span><span class="nx">current_schedule</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initCodeblockForm</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$codeblock_tabs</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_tabs&#39;</span><span class="p">);</span>
	<span class="nx">$codeblock_tabs</span><span class="p">.</span><span class="nx">tabs</span><span class="p">(</span> <span class="p">{</span>
		<span class="nx">select</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">saveCodeblockForm</span><span class="p">();</span>
			<span class="nx">current_block_id</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">panel</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">14</span><span class="p">));</span>
			<span class="nx">updateCodeblockForm</span><span class="p">();</span>
		<span class="p">},</span>
		<span class="nx">selected</span> <span class="o">:</span> <span class="nx">current_block_id</span>
	<span class="p">});</span>
	<span class="nx">updateCodeblockForm</span><span class="p">();</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#colorpicker&#39;</span><span class="p">).</span><span class="nx">ColorPicker</span><span class="p">(</span>
			<span class="p">{</span>
				<span class="nx">onChange</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hsb</span><span class="p">,</span> <span class="nx">hex</span><span class="p">,</span> <span class="nx">rgb</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#colorpicker&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">hex</span><span class="p">);</span>
					<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_color&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">hex</span><span class="p">);</span>
				<span class="p">},</span>
				<span class="nx">onBeforeShow</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#colorpicker&#39;</span><span class="p">).</span><span class="nx">ColorPickerSetColor</span><span class="p">(</span>
							<span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">codeblocks</span><span class="p">[</span><span class="nx">current_block_id</span><span class="p">].</span><span class="nx">block_color</span><span class="p">);</span>
				<span class="p">}</span>

			<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_add&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_add&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;enable&quot;</span><span class="p">);</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_add&#39;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">click</span><span class="p">(</span>
					<span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#codeblock_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;disable&quot;</span><span class="p">);</span>
						<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#codeblock_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
								<span class="s2">&quot;Adding...&quot;</span><span class="p">);</span>

						<span class="nx">jQuery</span>
								<span class="p">.</span><span class="nx">post</span><span class="p">(</span>
										<span class="nx">ajaxurl</span><span class="p">,</span>
										<span class="p">{</span>

											<span class="nx">action</span> <span class="o">:</span> <span class="s1">&#39;tw-ajax-codeblock-add&#39;</span>

										<span class="p">},</span>
										<span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
											<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
												<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span>
												<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">].</span><span class="nx">block_name</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_name</span><span class="p">;</span>
												<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">].</span><span class="nx">block_code</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_code</span><span class="p">;</span>
												<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">].</span><span class="nx">block_color</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_color</span><span class="p">;</span>
												<span class="nx">$codeblock_tabs</span>
														<span class="p">.</span><span class="nx">tabs</span><span class="p">(</span>
																<span class="s2">&quot;add&quot;</span><span class="p">,</span>
																<span class="s2">&quot;#codeblock_tab_&quot;</span>
																		<span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">,</span>
																<span class="nx">response</span><span class="p">.</span><span class="nx">block_name</span><span class="p">);</span>
												<span class="nx">$codeblock_tabs</span>
														<span class="p">.</span><span class="nx">tabs</span><span class="p">(</span>
																<span class="s2">&quot;select&quot;</span><span class="p">,</span>
																<span class="s2">&quot;#codeblock_tab_&quot;</span>
																		<span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">block_id</span><span class="p">);</span>
											<span class="p">}</span>
											<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#codeblock_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span>
													<span class="s2">&quot;enable&quot;</span><span class="p">);</span>
											<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#codeblock_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span>
													<span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
													<span class="s2">&quot;Add New Code Block&quot;</span><span class="p">);</span>
										<span class="p">});</span>
					<span class="p">});</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_save&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_save&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">saveCodeblockForm</span><span class="p">();</span>
	<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_remove&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_remove&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">codeblocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="nx">removeCodeblock</span><span class="p">();</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">current_block_id</span><span class="p">].</span><span class="nx">block_name</span> <span class="o">=</span> <span class="s2">&quot;Default Codeblock&quot;</span><span class="p">;</span>
			<span class="nx">codeblocks</span><span class="p">[</span><span class="nx">current_block_id</span><span class="p">].</span><span class="nx">block_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
			<span class="nx">updateCodeblockForm</span><span class="p">();</span>
			<span class="nx">saveCodeblockForm</span><span class="p">();</span>
		<span class="p">}</span>

	<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_name&#39;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span>
			<span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">(</span>
						<span class="s1">&#39;#codeblock_tabs&gt;ul&gt;li&gt;a[href=#codeblock_tab_&#39;</span>
								<span class="o">+</span> <span class="nx">current_block_id</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span>
						<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
			<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_reset&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#codeblock_reset&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span>
			<span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">updateCodeblockForm</span><span class="p">();</span>
				<span class="nx">jQuery</span><span class="p">(</span>
						<span class="s1">&#39;#codeblock_tabs&gt;ul&gt;li&gt;a[href=#codeblock_tab_&#39;</span>
								<span class="o">+</span> <span class="nx">current_block_id</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span>
						<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#codeblock_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
			<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initScheduleForm</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$schedule_tabs</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_tabs&#39;</span><span class="p">);</span>
	<span class="nx">$schedule_tabs</span><span class="p">.</span><span class="nx">tabs</span><span class="p">(</span> <span class="p">{</span>
		<span class="nx">select</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>saveCodeblockForm();</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">current_schedule_id</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">panel</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">13</span><span class="p">));</span>
			<span class="kd">var</span> <span class="nx">$panel</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_panel&#39;</span><span class="p">).</span><span class="nx">detach</span><span class="p">();</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_tab_&#39;</span> <span class="o">+</span> <span class="nx">current_schedule_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$panel</span><span class="p">);</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>

		<span class="p">},</span>
		<span class="nx">selected</span> <span class="o">:</span> <span class="nx">current_schedule_id</span>
	<span class="p">});</span>
	<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_tab_&#39;</span> <span class="o">+</span> <span class="nx">current_schedule_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span>
			<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_panel&#39;</span><span class="p">).</span><span class="nx">detach</span><span class="p">());</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_dialog&#39;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">dialog</span><span class="p">(</span>
					<span class="p">{</span>
						<span class="nx">autoOpen</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
						<span class="nx">modal</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
						<span class="nx">resizable</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
						<span class="nx">buttons</span> <span class="o">:</span> <span class="p">{</span>
							<span class="s2">&quot;Save&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

								<span class="nx">jQuery</span>
										<span class="p">.</span><span class="nx">post</span><span class="p">(</span>
												<span class="nx">ajaxurl</span><span class="p">,</span>
												<span class="p">{</span>

													<span class="nx">action</span> <span class="o">:</span> <span class="s1">&#39;tw-ajax-schedule-update&#39;</span><span class="p">,</span>
													<span class="nx">schedule_id</span> <span class="o">:</span> <span class="nx">current_schedule_id</span><span class="p">,</span>
													<span class="nx">schedule_title</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
															<span class="s1">&#39;#schedule_name&#39;</span><span class="p">)</span>
															<span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
													<span class="nx">schedule_default</span> <span class="o">:</span> <span class="nx">jQuery</span><span class="p">(</span>
															<span class="s1">&#39;#schedule_default&#39;</span><span class="p">)</span>
															<span class="p">.</span><span class="nx">val</span><span class="p">()</span>

												<span class="p">},</span>
												<span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
													<span class="nx">jQuery</span><span class="p">(</span>
															<span class="s1">&#39;#schedule_tabs&gt;ul&gt;li&gt;a[href=#schedule_tab_&#39;</span>
																	<span class="o">+</span> <span class="nx">current_schedule_id</span>
																	<span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
															<span class="p">.</span><span class="nx">text</span><span class="p">(</span>
																	<span class="nx">jQuery</span><span class="p">(</span>
																			<span class="s1">&#39;#schedule_name&#39;</span><span class="p">)</span>
																			<span class="p">.</span><span class="nx">val</span><span class="p">());</span>
													<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_dialog&#39;</span><span class="p">)</span>
															<span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
												<span class="p">});</span>
							<span class="p">},</span>
							<span class="s2">&quot;Cancel&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
								<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">},</span>
						<span class="nx">open</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
							<span class="kd">var</span> <span class="nx">$default_select</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_default&#39;</span><span class="p">);</span>
							<span class="kd">var</span> <span class="nx">select_html</span><span class="p">;</span>
							<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_name&#39;</span><span class="p">)</span>
									<span class="p">.</span><span class="nx">val</span><span class="p">(</span>
											<span class="nx">jQuery</span><span class="p">(</span>
													<span class="s1">&#39;#schedule_tabs&gt;ul&gt;li&gt;a[href=#schedule_tab_&#39;</span>
															<span class="o">+</span> <span class="nx">current_schedule_id</span>
															<span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
							<span class="nx">populateWithCodeblocks</span><span class="p">(</span><span class="nx">$default_select</span><span class="p">);</span>
							<span class="nx">select_html</span> <span class="o">=</span> <span class="nx">$default_select</span><span class="p">.</span><span class="nx">html</span><span class="p">();</span>
							<span class="nx">select_html</span> <span class="o">=</span> <span class="s2">&quot;&lt;option value=&#39;none&#39;&gt;Nothing&lt;/option&gt;&quot;</span>
									<span class="o">+</span> <span class="nx">select_html</span><span class="p">;</span>
							<span class="nx">$default_select</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">select_html</span><span class="p">);</span>
						<span class="p">}</span>
					<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_add&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_add&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;enable&quot;</span><span class="p">);</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_add&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span>
			<span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#schedule_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;disable&quot;</span><span class="p">);</span>
				<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#schedule_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;Adding...&quot;</span><span class="p">);</span>

				<span class="nx">jQuery</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">ajaxurl</span><span class="p">,</span> <span class="p">{</span>

					<span class="nx">action</span> <span class="o">:</span> <span class="s1">&#39;tw-ajax-schedule-add&#39;</span>

				<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

					<span class="nx">$schedule_tabs</span><span class="p">.</span><span class="nx">tabs</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;#schedule_tab_&quot;</span>
							<span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">schedule_id</span><span class="p">,</span>
							<span class="nx">response</span><span class="p">.</span><span class="nx">schedules</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">schedule_id</span><span class="p">].</span><span class="nx">title</span><span class="p">);</span>
					<span class="nx">$schedule_tabs</span><span class="p">.</span><span class="nx">tabs</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="s2">&quot;#schedule_tab_&quot;</span>
							<span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">schedule_id</span><span class="p">);</span>
					<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#schedule_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;enable&quot;</span><span class="p">);</span>
					<span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#schedule_add&quot;</span><span class="p">).</span><span class="nx">button</span><span class="p">(</span><span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
							<span class="s2">&quot;Add Schedule&quot;</span><span class="p">);</span>
				<span class="p">});</span>
			<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_edit&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_edit&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#schedule_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_remove&#39;</span><span class="p">).</span><span class="nx">button</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#schedule_remove&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">removeSchedule</span><span class="p">();</span>
	<span class="p">});</span>

<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initTimeslotForm</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#timeslot_start_time&#39;</span><span class="p">).</span><span class="nx">suggest</span><span class="p">(</span><span class="nx">generateTimeSuggestions</span><span class="p">,</span> <span class="p">{});</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#timeslot_end_time&#39;</span><span class="p">).</span><span class="nx">suggest</span><span class="p">(</span><span class="nx">generateTimeSuggestions</span><span class="p">,</span> <span class="p">{});</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#timeslot_start_date&#39;</span><span class="p">).</span><span class="nx">datepicker</span><span class="p">();</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#timeslot_end_date&#39;</span><span class="p">).</span><span class="nx">datepicker</span><span class="p">();</span>

	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#timeslot_dialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span> <span class="p">{</span>
		<span class="nx">autoOpen</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
		<span class="nx">modal</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="nx">resizable</span> <span class="o">:</span> <span class="kc">false</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initCalendar</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span> <span class="p">{</span>
		<span class="nx">timeslotsPerHour</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
		<span class="nx">height</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$calendar</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">draggable</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">,</span> <span class="nx">eventElement</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">resizable</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">,</span> <span class="nx">eventElement</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">},</span>

		<span class="nx">allowCalEventOverlap</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="nx">overlapEventsSeparate</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="nx">eventRender</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">,</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">calEvent</span><span class="p">.</span><span class="nx">color</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">rgb</span> <span class="o">=</span> <span class="nx">HexToRGB</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">.</span><span class="nx">r</span> <span class="o">+</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">g</span> <span class="o">+</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&gt;</span> <span class="mi">128</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$event</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;#000000&quot;</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="nx">$event</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">$event</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;backgroundColor&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">calEvent</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
			<span class="p">}</span>

		<span class="p">},</span>
		<span class="nx">eventNew</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">,</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">addNewTimeslot</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">);</span>
		<span class="p">},</span>

		<span class="nx">eventClick</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">,</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">updateTimeslot</span><span class="p">(</span><span class="nx">calEvent</span><span class="p">);</span>
		<span class="p">},</span>

		<span class="nx">title</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="nx">calendar</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="s2">&quot;Scheduled Codeblocks&quot;</span><span class="p">;</span>
		<span class="p">},</span>

		<span class="nx">data</span> <span class="o">:</span> <span class="nx">getCalendarData</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

	<span class="nx">readEmbeddedJSON</span><span class="p">(</span><span class="nx">$</span><span class="p">);</span>

	<span class="nx">initCodeblockForm</span><span class="p">(</span><span class="nx">$</span><span class="p">);</span>
	<span class="nx">initScheduleForm</span><span class="p">(</span><span class="nx">$</span><span class="p">);</span>
	<span class="nx">initTimeslotForm</span><span class="p">(</span><span class="nx">$</span><span class="p">);</span>
	<span class="nx">initCalendar</span><span class="p">(</span><span class="nx">$</span><span class="p">);</span>

	<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#accordion&quot;</span><span class="p">).</span><span class="nx">accordion</span><span class="p">(</span> <span class="p">{</span>
		<span class="nx">header</span> <span class="o">:</span> <span class="s1">&#39;h3&#39;</span><span class="p">,</span>
		<span class="nx">autoHeight</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
		<span class="nx">change</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#calendar&#39;</span><span class="p">).</span><span class="nx">weekCalendar</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 